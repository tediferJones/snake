function f(u,N,A){const j=document.createElement(u);if(N)Object.keys(N).forEach((x)=>j[x]=N[x]);if(A?.length)j.append(...A.filter((x)=>x!=null));return j}function G({boardSize:u}){return f("div",{className:"w-full m-8 border-4 border-black flex flex-col bg-gray-200"},[...Array(u).keys()].map((N)=>{return f("div",{className:"flex flex-1"},[...Array(u).keys()].map((A)=>{return f("div",{id:`cell-${N}-${A}`,className:"aspect-square flex-1 flex justify-center items-center border-2 border-gray-300"})}))}))}var $,q;document.addEventListener("keydown",(u)=>{console.log(u.key,q);const N=u.key;if(!$||$.readyState>1)return;console.log("sending websocket msg");const A=["ArrowUp","ArrowDown"],j=["ArrowRight","ArrowLeft"];if(q){const x=q.players[q.uuid].dir;if(console.log("current player dir",x),A.includes(N)&&A.includes(x))return console.log("ignore vertical move");if(j.includes(N)&&j.includes(x))return console.log("ignore horizontal move")}if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(u.key))$?.send(u.key)});document.body.append(f("div",{className:"p-4 flex justify-between items-center border-b-2"},[f("button",{textContent:"Join General Lobby",className:"p-4 border-4 border-black",onclick:()=>{const{host:u,protocol:N}=window.location,A=document.querySelector("#colorPicker").value.slice(1);console.log(A),$=new WebSocket(`${N==="http:"?"ws":"wss"}://${u}?gameCode=general&color=${A}`),$.onmessage=(j)=>{const x=JSON.parse(j.data);q=x,document.querySelector("#gameOver").textContent="";const m=document.querySelector("#board");if(!m)throw Error("Cant find board element");while(m.firstChild)m.removeChild(m.firstChild);m.appendChild(G({boardSize:x.boardSize})),Object.values(x.players).forEach((k)=>{if(k.state!=="playing"){if(k.uuid===x.uuid)document.querySelector("#gameOver").textContent=k.state;return}const{pos:b,color:B}=k;b.forEach((S)=>{document.querySelector(`#cell-${S.row}-${S.col}`).style.backgroundColor=`#${B}`})}),x.foodLocations.forEach((k)=>{document.querySelector(`#cell-${k.row}-${k.col}`).textContent="*"})}}}),f("label",{className:"flex items-center gap-4",textContent:"Pick you color:",htmlFor:"colorPicker"},[f("input",{id:"colorPicker",type:"color",value:"#"+[...Array(6).keys()].map(()=>Math.floor(Math.random()*16).toString(16)).join("")})]),f("span",{id:"gameOver"}),f("button",{textContent:"Disconnect",className:"p-4 border-4 border-black",onclick:()=>$?.close()})]),f("div",{id:"board",className:"aspect-square flex justify-center items-center"}),f("div",{className:"grid grid-cols-3 w-1/2 mx-auto"},[f("div"),f("div",{className:"aspect-square text-8xl",textContent:"\u2B06",onclick:()=>$?.send("ArrowUp")}),f("div"),f("div",{className:"aspect-square text-8xl",textContent:"\u2B05",onclick:()=>$?.send("ArrowLeft")}),f("div"),f("div",{className:"aspect-square text-8xl",textContent:"\u27A1",onclick:()=>$?.send("ArrowRight")}),f("div"),f("div",{className:"aspect-square text-8xl",textContent:"\u2B07",onclick:()=>$?.send("ArrowDown")}),f("div")]));
