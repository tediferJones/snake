function x(u,A,G){const j=document.createElement(u);if(A)Object.keys(A).forEach((I)=>j[I]=A[I]);if(G?.length)j.append(...G.filter((I)=>I!=null));return j}function Q({boardSize:u}){return x("div",{className:"w-full m-8 border-4 border-black flex flex-col bg-gray-200"},[...Array(u).keys()].map((A)=>{return x("div",{className:"flex flex-1"},[...Array(u).keys()].map((G)=>{return x("div",{id:`cell-${A}-${G}`,className:"aspect-square flex-1 flex justify-center items-center border-[1px] border-gray-300"})}))}))}function S({changeDirFunc:u}){return x("div",{className:"grid grid-cols-3 mx-auto"},[x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u2B06",onclick:()=>u("ArrowUp")}),x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u2B05",onclick:()=>u("ArrowLeft")}),x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u27A1",onclick:()=>u("ArrowRight")}),x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u2B07",onclick:()=>u("ArrowDown")}),x("div")])}var V=function(u){if(!$||$.readyState>1)return;console.log("sending websocket msg");const A=["ArrowUp","ArrowDown"],G=["ArrowRight","ArrowLeft"];if(L){const j=L.players[L.uuid].dir;if(console.log("current player dir",j),A.includes(u)&&A.includes(j))return console.log("ignore vertical move");if(G.includes(u)&&G.includes(j))return console.log("ignore horizontal move")}$.send(u)},$,L,X={ArrowUp:"-rotate-90",ArrowRight:"rotate-0",ArrowDown:"rotate-90",ArrowLeft:"rotate-180"},Y={ArrowUp:"rounded-t-3xl",ArrowRight:"rounded-r-3xl",ArrowDown:"rounded-b-3xl",ArrowLeft:"rounded-l-3xl"};document.addEventListener("keydown",(u)=>{if(console.log(u.key,L),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(u.key))V(u.key)});document.body.className="flex flex-col justify-between max-h-screen";document.body.append(x("div",{className:"p-4 flex justify-between items-center border-b-2"},[x("button",{textContent:"Join General Lobby",className:"p-4 border-4 border-black",onclick:(u)=>{const{host:A,protocol:G}=window.location,j=document.querySelector("#colorPicker").value.slice(1);if(console.log(j),$){$.close(),$=void 0,u.currentTarget.textContent="Join Game";return}u.currentTarget.textContent="Disconnect",$=new WebSocket(`${G==="http:"?"ws":"wss"}://${A}?gameCode=general&color=${j}`),$.onmessage=(I)=>{const B=JSON.parse(I.data);L=B,document.querySelector("#gameOver").textContent="";const J=document.querySelector("#board");if(!J)throw Error("Cant find board element");while(J.firstChild)J.removeChild(J.firstChild);J.appendChild(Q({boardSize:B.boardSize})),document.querySelector("#gameOver").textContent=B.players[B.uuid].state,Object.values(B.players).filter((U)=>U.state!=="gameover").forEach((U)=>{const{pos:O,color:W}=U,R=`#${W}`;O.forEach(({row:v,col:q},P)=>{const N=document.querySelector(`#cell-${v}-${q}`);if(N.style.backgroundColor=R,P===0)N.classList.add(Y[U.dir]),N.appendChild(x("div",{className:`h-full w-full flex flex-col justify-center items-center ${X[U.dir]}`},[x("div",{className:"h-1/5 w-1/5 bg-black rounded-full"}),x("div",{className:"h-1/5 w-1/5"}),x("div",{className:"h-1/5 w-1/5 bg-black rounded-full"})]));const k=O[P-1],m=O[P+1];if(k){if(k.row<v)N.style.borderTopColor=R;if(k.row>v)N.style.borderBottomColor=R;if(k.col<q)N.style.borderLeftColor=R;if(k.col>q)N.style.borderRightColor=R}if(m){if(v<m.row)N.style.borderBottomColor=R;if(v>m.row)N.style.borderTopColor=R;if(q<m.col)N.style.borderRightColor=R;if(q>m.col)N.style.borderLeftColor=R}if(k&&m){if(k.row<v&&m.col<q)N.classList.add("rounded-br-3xl");if(k.row<v&&m.col>q)N.classList.add("rounded-bl-3xl");if(k.row>v&&m.col<q)N.classList.add("rounded-tr-3xl");if(k.row>v&&m.col>q)N.classList.add("rounded-tl-3xl");if(v<m.row&&q<k.col)N.classList.add("rounded-tl-3xl");if(v<m.row&&q>k.col)N.classList.add("rounded-tr-3xl");if(v>m.row&&q<k.col)N.classList.add("rounded-bl-3xl");if(v>m.row&&q>k.col)N.classList.add("rounded-br-3xl")}})}),console.log("rendering food",B.foodLocations),B.foodLocations.forEach((U)=>{document.querySelector(`#cell-${U.row}-${U.col}`)?.append(x("div",{className:"h-1/2 w-1/2 bg-black rotate-45"}))})}}}),x("label",{className:"flex items-center gap-4",textContent:"Pick you color:",htmlFor:"colorPicker"},[x("input",{id:"colorPicker",type:"color",value:"#"+[...Array(6).keys()].map(()=>Math.floor(Math.random()*16).toString(16)).join("")})]),x("span",{id:"gameOver"})]),x("div",{id:"board",className:"aspect-square flex justify-center items-center"}),S({changeDirFunc:V}));
