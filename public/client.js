function $(k,G,A){const N=document.createElement(k);if(G)Object.keys(G).forEach((j)=>N[j]=G[j]);if(A?.length)N.append(...A.filter((j)=>j!=null));return N}function W({changeDirFunc:k}){return $("div",{id:"onScreenControls",className:"mx-auto aspect-square w-3/4 md:w-1/4 flex justify-center items-center hidden"},[$("div",{className:"aspect-square w-3/4 grid grid-cols-2 mx-auto rotate-45"},[$("div",{className:"aspect-square bg-black m-2 flex justify-center items-center",onclick:()=>k("ArrowUp")},[$("div",{className:"mb-8 mr-8 -rotate-45 w-0 h-0 border-l-[20px] border-r-[20px] border-b-[30px] border-transparent border-b-white"})]),$("div",{className:"aspect-square bg-black m-2 flex justify-center items-center",onclick:()=>k("ArrowRight")},[$("div",{className:"mb-8 ml-8 rotate-45 w-0 h-0 border-l-[20px] border-r-[20px] border-b-[30px] border-transparent border-b-white"})]),$("div",{className:"aspect-square bg-black m-2 flex justify-center items-center",onclick:()=>k("ArrowLeft")},[$("div",{className:"mt-8 mr-8 rotate-45 w-0 h-0 border-l-[20px] border-r-[20px] border-t-[30px] border-transparent border-t-white"})]),$("div",{className:"aspect-square bg-black m-2 flex justify-center items-center",onclick:()=>k("ArrowDown")},[$("div",{className:"mt-8 ml-8 -rotate-45 w-0 h-0 border-l-[20px] border-r-[20px] border-t-[30px] border-transparent border-t-white"})])])])}function X({boardSize:k}){return $("div",{className:"w-full md:w-1/2 mx-8 border-4 border-black flex flex-col bg-gray-200"},[...Array(k).keys()].map((G)=>{return $("div",{className:"flex flex-1"},[...Array(k).keys()].map((A)=>{return $("div",{id:`cell-${G}-${A}`,className:"aspect-square flex-1 flex justify-center items-center border-[1px] border-gray-300"})}))}))}function Y(k,G){return k.split("").reduce((A,N,j)=>{if(j===0)return N.toUpperCase();if("A"<=N&&N<="Z")return`${A} ${N}`;return A+N},"")+(G?"s":"")}var Q=function(k){const G=document.querySelector(`#${k}`);if(!G)throw Error("Cant find board element");while(G.firstChild)G.removeChild(G.firstChild);return G},z=function(k){const G=parseInt(k.substring(0,2),16),A=parseInt(k.substring(2,4),16),N=parseInt(k.substring(4,6),16),j=(255-G).toString(16).padStart(2,"0"),q=(255-A).toString(16).padStart(2,"0"),E=(255-N).toString(16).padStart(2,"0");return`#${j}${q}${E}`},H=function(k){if(!L||L.readyState>1)return;if(O?.players[O.uuid].state!=="playing")return;const G=["ArrowUp","ArrowDown"],A=["ArrowRight","ArrowLeft"];if(O){const N=O.players[O.uuid].dir;if(G.includes(k)&&G.includes(N))return;if(A.includes(k)&&A.includes(N))return}L.send(JSON.stringify({action:"changeDir",dir:k}))},S=function(k){k.preventDefault();const{host:G,protocol:A}=window.location,N=document.querySelector("#colorPicker").value.slice(1),j=document.querySelector("#gameCode").value,q=document.querySelector("#username").value;document.querySelector("#connectForm")?.classList.add("hidden"),document.querySelector("#connectedInfo")?.classList.remove("hidden"),L=new WebSocket(`${A==="http:"?"ws":"wss"}://${G}?gameCode=${j||"general"}&color=${N}&username=${q}`),L.onmessage=(E)=>{const U=JSON.parse(E.data);O=U,document.querySelector("#gameState").textContent=Y(U.players[U.uuid].state),document.querySelector("#playerCount").textContent=`Player Count: ${Object.keys(U.players).length.toString()}`,B[U.gameState](U)},L.onclose=()=>{window.location.reload()}},L,O,P=new URL(window.location.href).searchParams.get("gameCode"),R={ArrowUp:"-rotate-90",ArrowRight:"rotate-0",ArrowDown:"rotate-90",ArrowLeft:"rotate-180"},T={ArrowUp:"rounded-t-3xl",ArrowRight:"rounded-r-3xl",ArrowDown:"rounded-b-3xl",ArrowLeft:"rounded-l-3xl"},_=new Set(["playing","winner"]),B={running:(k)=>{document.querySelector("#onScreenControls")?.classList.remove("hidden"),Q("board").appendChild(X({boardSize:k.boardSize})),Object.values(k.players).filter((A)=>_.has(A.state)||_.has(A.oldState)).forEach((A)=>{const{pos:N,color:j}=A,q=`#${j}`;N.forEach(({row:E,col:U},V)=>{const Z=document.querySelector(`#cell-${E}-${U}`);if(Z.style.backgroundColor=q,V===0)Z.classList.add(T[A.dir]),Z.appendChild($("div",{className:`h-full w-full flex flex-col justify-center items-center ${R[A.dir]}`},[$("div",{className:"h-1/5 w-1/5 rounded-full",id:`lefteye-${A.uuid}`}),$("div",{className:"h-1/5 w-1/5"}),$("div",{className:"h-1/5 w-1/5 rounded-full",id:`righteye-${A.uuid}`})])),document.querySelector(`#lefteye-${A.uuid}`).style.backgroundColor=z(A.color),document.querySelector(`#righteye-${A.uuid}`).style.backgroundColor=z(A.color);const I=N[V-1],J=N[V+1];if(I){if(I.row<E)Z.style.borderTopColor=q;if(I.row>E)Z.style.borderBottomColor=q;if(I.col<U)Z.style.borderLeftColor=q;if(I.col>U)Z.style.borderRightColor=q}if(J){if(E<J.row)Z.style.borderBottomColor=q;if(E>J.row)Z.style.borderTopColor=q;if(U<J.col)Z.style.borderRightColor=q;if(U>J.col)Z.style.borderLeftColor=q}if(I&&J){if(I.row<E&&J.col<U)Z.classList.add("rounded-br-3xl");if(I.row<E&&J.col>U)Z.classList.add("rounded-bl-3xl");if(I.row>E&&J.col<U)Z.classList.add("rounded-tr-3xl");if(I.row>E&&J.col>U)Z.classList.add("rounded-tl-3xl");if(E<J.row&&U<I.col)Z.classList.add("rounded-tl-3xl");if(E<J.row&&U>I.col)Z.classList.add("rounded-tr-3xl");if(E>J.row&&U<I.col)Z.classList.add("rounded-bl-3xl");if(E>J.row&&U>I.col)Z.classList.add("rounded-br-3xl")}})}),k.foodLocations.forEach((A)=>{document.querySelector(`#cell-${A.row}-${A.col}`)?.append($("div",{className:"h-1/2 w-1/2 bg-black rotate-45"}))})},lobby:(k)=>{const G=k.players[k.uuid].state==="ready";Q("leaderboard"),Q("board").appendChild($("div",{className:"flex flex-col gap-8 items-center"},[$("div",{textContent:`Players ready: ${Object.values(k.players).filter((N)=>N.state==="ready").length} / ${Object.keys(k.players).length}`}),$("button",{className:"flex border-2 rounded-xl border-black overflow-hidden",onclick:async(N)=>{if(O){const j=new URL(window.location.href);j.searchParams.set("gameCode",O?.players[O.uuid].gameCode),await navigator.clipboard.writeText(j.href),document.querySelector("#buttonLeft")?.classList.toggle("min-w-full"),document.querySelector("#buttonLeft")?.classList.toggle("min-w-0"),document.querySelector("#buttonLeft")?.classList.toggle("px-0"),document.querySelector("#buttonRight")?.classList.toggle("min-w-0"),document.querySelector("#buttonRight")?.classList.toggle("min-w-full"),setTimeout(()=>{document.querySelector("#buttonLeft")?.classList.toggle("min-w-full"),document.querySelector("#buttonLeft")?.classList.toggle("min-w-0"),document.querySelector("#buttonLeft")?.classList.toggle("px-0"),document.querySelector("#buttonRight")?.classList.toggle("min-w-0"),document.querySelector("#buttonRight")?.classList.toggle("min-w-full")},5000)}}},[$("input",{id:"iosCopyHack",type:"hidden"}),$("span",{id:"buttonLeft",textContent:"Share",className:"p-4 transition-all duration-1000 bg-gray-200 min-w-full overflow-hidden"}),$("span",{id:"buttonRight",textContent:"Copied",className:"p-4 transition-all duration-1000 bg-gray-400 min-w-0 overflow-hidden"})]),$("div",{className:"p-4 flex justify-center items-center gap-4 bg-gray-200 rounded-xl border-2 border-black"},[$("div",{textContent:"Are you ready?"}),$("button",{textContent:"\uD83D\uDC4D",className:`aspect-square p-2 text-6xl transition-all duration-1000 border-2 rounded-xl ${G?"bg-green-300 text-green-500 border-green-500":"rotate-180 bg-red-300 text-red-500 border-red-500"}`,onclick:()=>{L?.send(JSON.stringify({action:"toggleReady"}))}})])]))},done:(k)=>{B.running(k);const G=k.players[k.uuid].state==="rematch",A=Q("leaderboard");document.querySelector("#onScreenControls")?.classList.add("hidden");const N={winner:"bg-yellow-500",gameOver:"bg-red-500",rematch:"bg-green-500"};A.appendChild($("div",{className:"flex flex-col items-center gap-4"},[$("div",{textContent:`Players ready: ${Object.values(k.players).filter((j)=>j.state==="rematch").length} / ${Object.keys(k.players).length}`}),$("div",{className:"p-4 flex justify-center items-center gap-4 bg-gray-200 rounded-xl border-2 border-black"},[$("div",{textContent:"Do you want a rematch?"}),$("button",{textContent:"\uD83D\uDC4D",className:`aspect-square p-2 text-6xl transition-all duration-1000 border-2 rounded-xl ${G?"bg-green-300 text-green-500 border-green-500":"rotate-180 bg-red-300 text-red-500 border-red-500"}`,onclick:()=>{L?.send(JSON.stringify({action:"toggleRematch"}))}})]),...Object.values(k.players).filter((j)=>j.pos&&j.pos.length>0).sort((j,q)=>q.pos.length-j.pos.length).map((j,q)=>$("div",{className:`flex gap-4 items-center justify-between p-4 w-full ${N[j.state]}`},[$("span",{textContent:`${q+1}.)`}),$("span",{textContent:j.username,className:"text-xl font-bold"}),$("span",{textContent:j.pos.length.toString()})]))]))}};document.addEventListener("keydown",(k)=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(k.key))H(k.key)});document.body.className="flex flex-col gap-8 justify-between max-w-screen max-h-screen";document.body.append($("div",{className:"p-8 border-b-2 flex-wrap"},[$("form",{id:"connectForm",className:"flex flex-col justify-center items-center gap-8",onsubmit:S},[$("label",{className:"flex items-center gap-4",textContent:"Pick you color:",htmlFor:"colorPicker"},[$("input",{id:"colorPicker",type:"color",value:"#"+[...Array(6).keys()].map(()=>Math.floor(Math.random()*16).toString(16)).join("")})]),$("label",{className:"flex flex-wrap justify-center items-center gap-4",textContent:"Username"},[$("input",{className:"border-2 border-black p-4 rounded-xl",id:"username",type:"text",maxLength:"32",required:!0,value:[...Array(6).keys()].map(()=>String.fromCharCode(Math.floor(Math.random()*57)+65)).join("")})]),$("label",{className:"flex flex-wrap justify-center items-center gap-4",textContent:"Game Code"},[$("input",{id:"gameCode",className:"border-2 border-black p-4 rounded-xl",type:"text",minLength:"5",maxLength:"5",required:!1,placeholder:"Leave blank to enter general lobby",value:P||""})]),$("button",{textContent:"Join General Lobby",className:"p-4 border-2 border-black rounded-xl",id:"joinBtn",type:"submit"})]),$("div",{id:"connectedInfo",className:"flex justify-center items-center gap-8 hidden"},[$("button",{textContent:"Disconnect",className:"border-2 border-black p-4 rounded-xl",onclick:()=>{L?.close(),L=void 0,Q("board"),document.querySelector("#connectedInfo")?.classList.add("hidden"),document.querySelector("#connectForm")?.classList.remove("hidden"),document.querySelector("#onScreenControls")?.classList.add("hidden")}}),$("span",{id:"gameState"}),$("span",{id:"playerCount"})])]),$("div",{id:"board",className:"flex justify-center items-center"}),W({changeDirFunc:H}),$("div",{id:"leaderboard",className:"w-min mx-auto mb-8"}));
