function x(t,f,a){const u=document.createElement(t);if(f)Object.keys(f).forEach((k)=>u[k]=f[k]);if(a?.length)u.append(...a.filter((k)=>k!=null));return u}function C({boardSize:t}){return x("div",{className:"w-full m-8 border-4 border-black flex flex-col bg-gray-200"},[...Array(t).keys()].map((f)=>{return x("div",{className:"flex flex-1"},[...Array(t).keys()].map((a)=>{return x("div",{id:`cell-${f}-${a}`,className:"aspect-square flex-1 flex justify-center items-center border-[1px] border-gray-300"})}))}))}function $({changeDirFunc:t}){return x("div",{className:"grid grid-cols-3 mx-auto"},[x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u2B06",onclick:()=>t("ArrowUp")}),x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u2B05",onclick:()=>t("ArrowLeft")}),x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u27A1",onclick:()=>t("ArrowRight")}),x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u2B07",onclick:()=>t("ArrowDown")}),x("div")])}var G=function(t){if(!m||m.readyState>1)return;console.log("sending websocket msg");const f=["ArrowUp","ArrowDown"],a=["ArrowRight","ArrowLeft"];if(q){const u=q.players[q.uuid].dir;if(console.log("current player dir",u),f.includes(t)&&f.includes(u))return console.log("ignore vertical move");if(a.includes(t)&&a.includes(u))return console.log("ignore horizontal move")}m.send(t)},m,q;document.addEventListener("keydown",(t)=>{if(console.log(t.key,q),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key))G(t.key)});document.body.className="flex flex-col justify-between max-h-screen";document.body.append(x("div",{className:"p-4 flex justify-between items-center border-b-2"},[x("button",{textContent:"Join General Lobby",className:"p-4 border-4 border-black",onclick:(t)=>{const{host:f,protocol:a}=window.location,u=document.querySelector("#colorPicker").value.slice(1);if(console.log(u),m){m.close(),m=void 0,t.currentTarget.textContent="Join Game";return}t.currentTarget.textContent="Disconnect",m=new WebSocket(`${a==="http:"?"ws":"wss"}://${f}?gameCode=general&color=${u}`),m.onmessage=(k)=>{const v=JSON.parse(k.data);q=v,document.querySelector("#gameOver").textContent="";const A=document.querySelector("#board");if(!A)throw Error("Cant find board element");while(A.firstChild)A.removeChild(A.firstChild);A.appendChild(C({boardSize:v.boardSize})),Object.values(v.players).forEach((N)=>{if(N.state!=="playing"){if(N.uuid===v.uuid)document.querySelector("#gameOver").textContent=N.state;return}const{pos:L,color:R}=N;L.forEach((j)=>{document.querySelector(`#cell-${j.row}-${j.col}`).style.backgroundColor=`#${R}`})}),v.foodLocations.forEach((N)=>{document.querySelector(`#cell-${N.row}-${N.col}`)?.append(x("div",{className:"h-1/2 w-1/2 bg-black rotate-45"}))})}}}),x("label",{className:"flex items-center gap-4",textContent:"Pick you color:",htmlFor:"colorPicker"},[x("input",{id:"colorPicker",type:"color",value:"#"+[...Array(6).keys()].map(()=>Math.floor(Math.random()*16).toString(16)).join("")})]),x("span",{id:"gameOver"})]),x("div",{id:"board",className:"aspect-square flex justify-center items-center"}),$({changeDirFunc:G}));
