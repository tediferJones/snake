function x(u,q,N){const $=document.createElement(u);if(q)Object.keys(q).forEach((I)=>$[I]=q[I]);if(N?.length)$.append(...N.filter((I)=>I!=null));return $}function Q({boardSize:u}){return x("div",{className:"w-full m-8 border-4 border-black flex flex-col bg-gray-200"},[...Array(u).keys()].map((q)=>{return x("div",{className:"flex flex-1"},[...Array(u).keys()].map((N)=>{return x("div",{id:`cell-${q}-${N}`,className:"aspect-square flex-1 flex justify-center items-center border-[1px] border-gray-300"})}))}))}function R({changeDirFunc:u}){return x("div",{className:"grid grid-cols-3 mx-auto"},[x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u2B06",onclick:()=>u("ArrowUp")}),x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u2B05",onclick:()=>u("ArrowLeft")}),x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u27A1",onclick:()=>u("ArrowRight")}),x("div"),x("div",{className:"aspect-square text-7xl",textContent:"\u2B07",onclick:()=>u("ArrowDown")}),x("div")])}var V=function(u){const q=parseInt(u.substring(0,2),16),N=parseInt(u.substring(2,4),16),$=parseInt(u.substring(4,6),16),I=(255-q).toString(16).padStart(2,"0"),L=(255-N).toString(16).padStart(2,"0"),v=(255-$).toString(16).padStart(2,"0");return`#${I}${L}${v}`},W=function(u){if(!J||J.readyState>1)return;if(console.log("sending websocket msg"),O?.players[O.uuid].state!=="playing")return;const q=["ArrowUp","ArrowDown"],N=["ArrowRight","ArrowLeft"];if(O){const $=O.players[O.uuid].dir;if(console.log("current player dir",$),q.includes(u)&&q.includes($))return console.log("ignore vertical move");if(N.includes(u)&&N.includes($))return console.log("ignore horizontal move")}J.send(JSON.stringify({action:"changeDir",dir:u}))},_=function(u){u.preventDefault();const{host:q,protocol:N}=window.location,$=document.querySelector("#colorPicker").value.slice(1),I=document.querySelector("#gameCode").value.toUpperCase(),L=document.querySelector("#joinBtn");if(console.log($),J){J.close(),J=void 0,L.textContent="Join Game";return}L.textContent="Disconnect",J=new WebSocket(`${N==="http:"?"ws":"wss"}://${q}?gameCode=${I||"general"}&color=${$}`),J.onmessage=(v)=>{const k=JSON.parse(v.data);O=k,document.querySelector("#gameOver").textContent=k.players[k.uuid].state,document.querySelector("#playerCount").textContent=`Player Count: ${Object.keys(k.players).length.toString()}`,Z[k.gameState](k)}},J,O,X={ArrowUp:"-rotate-90",ArrowRight:"rotate-0",ArrowDown:"rotate-90",ArrowLeft:"rotate-180"},Y={ArrowUp:"rounded-t-3xl",ArrowRight:"rounded-r-3xl",ArrowDown:"rounded-b-3xl",ArrowLeft:"rounded-l-3xl"},Z={running:(u)=>{const q=document.querySelector("#board");if(!q)throw Error("Cant find board element");while(q.firstChild)q.removeChild(q.firstChild);q.appendChild(Q({boardSize:u.boardSize})),Object.values(u.players).filter((N)=>N.state!=="gameover").forEach((N)=>{const{pos:$,color:I}=N,L=`#${I}`;$.forEach(({row:v,col:k},P)=>{const A=document.querySelector(`#cell-${v}-${k}`);if(A.style.backgroundColor=L,P===0)A.classList.add(Y[N.dir]),A.appendChild(x("div",{className:`h-full w-full flex flex-col justify-center items-center ${X[N.dir]}`},[x("div",{className:"h-1/5 w-1/5 rounded-full",id:`lefteye-${N.uuid}`}),x("div",{className:"h-1/5 w-1/5"}),x("div",{className:"h-1/5 w-1/5 rounded-full",id:`righteye-${N.uuid}`})])),document.querySelector(`#lefteye-${N.uuid}`).style.backgroundColor=V(N.color),document.querySelector(`#righteye-${N.uuid}`).style.backgroundColor=V(N.color);const U=$[P-1],G=$[P+1];if(U){if(U.row<v)A.style.borderTopColor=L;if(U.row>v)A.style.borderBottomColor=L;if(U.col<k)A.style.borderLeftColor=L;if(U.col>k)A.style.borderRightColor=L}if(G){if(v<G.row)A.style.borderBottomColor=L;if(v>G.row)A.style.borderTopColor=L;if(k<G.col)A.style.borderRightColor=L;if(k>G.col)A.style.borderLeftColor=L}if(U&&G){if(U.row<v&&G.col<k)A.classList.add("rounded-br-3xl");if(U.row<v&&G.col>k)A.classList.add("rounded-bl-3xl");if(U.row>v&&G.col<k)A.classList.add("rounded-tr-3xl");if(U.row>v&&G.col>k)A.classList.add("rounded-tl-3xl");if(v<G.row&&k<U.col)A.classList.add("rounded-tl-3xl");if(v<G.row&&k>U.col)A.classList.add("rounded-tr-3xl");if(v>G.row&&k<U.col)A.classList.add("rounded-bl-3xl");if(v>G.row&&k>U.col)A.classList.add("rounded-br-3xl")}})}),u.foodLocations.forEach((N)=>{document.querySelector(`#cell-${N.row}-${N.col}`)?.append(x("div",{className:"h-1/2 w-1/2 bg-black rotate-45"}))})},lobby:()=>{}};document.addEventListener("keydown",(u)=>{if(console.log(u.key,O),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(u.key))W(u.key)});document.body.className="flex flex-col justify-between max-h-screen";document.body.append(x("form",{className:"p-4 flex justify-between items-center border-b-2",onsubmit:_},[x("button",{textContent:"Join General Lobby",className:"p-4 border-4 border-black",id:"joinBtn",type:"submit"}),x("label",{className:"flex items-center gap-4",textContent:"Pick you color:",htmlFor:"colorPicker"},[x("input",{id:"colorPicker",type:"color",value:"#"+[...Array(6).keys()].map(()=>Math.floor(Math.random()*16).toString(16)).join("")})]),x("label",{className:"flex justify-center items-center gap-4",textContent:"Game Code"},[x("input",{id:"gameCode",className:"border-2 border-black p-4",type:"text",minLength:"5",maxLength:"5",required:!1})]),x("span",{id:"gameOver"}),x("span",{id:"playerCount"})]),x("div",{id:"board",className:"aspect-square flex justify-center items-center"}),R({changeDirFunc:W}));
