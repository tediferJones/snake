function f(x,u,C){const A=document.createElement(x);if(u)Object.keys(u).forEach(($)=>A[$]=u[$]);if(C?.length)A.append(...C.filter(($)=>$!=null));return A}function S({boardSize:x}){return f("div",{className:"w-full m-8 border-4 border-black flex flex-col bg-gray-200"},[...Array(x).keys()].map((u)=>{return f("div",{className:"flex flex-1"},[...Array(x).keys()].map((C)=>{return f("div",{id:`cell-${u}-${C}`,className:"aspect-square flex-1 flex justify-center items-center border-[1px] border-gray-300"})}))}))}var m=function(x){if(!G||G.readyState>1)return;console.log("sending websocket msg");const u=["ArrowUp","ArrowDown"],C=["ArrowRight","ArrowLeft"];if(q){const A=q.players[q.uuid].dir;if(console.log("current player dir",A),u.includes(x)&&u.includes(A))return console.log("ignore vertical move");if(C.includes(x)&&C.includes(A))return console.log("ignore horizontal move")}G.send(x)},G,q;document.addEventListener("keydown",(x)=>{if(console.log(x.key,q),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(x.key))m(x.key)});document.body.className="flex flex-col justify-between max-h-screen";document.body.append(f("div",{className:"p-4 flex justify-between items-center border-b-2"},[f("button",{textContent:"Join General Lobby",className:"p-4 border-4 border-black",onclick:(x)=>{const{host:u,protocol:C}=window.location,A=document.querySelector("#colorPicker").value.slice(1);if(console.log(A),G){G.close(),G=void 0,x.currentTarget.textContent="Join Game";return}x.currentTarget.textContent="Disconnect",G=new WebSocket(`${C==="http:"?"ws":"wss"}://${u}?gameCode=general&color=${A}`),G.onmessage=($)=>{const j=JSON.parse($.data);q=j,document.querySelector("#gameOver").textContent="";const k=document.querySelector("#board");if(!k)throw Error("Cant find board element");while(k.firstChild)k.removeChild(k.firstChild);k.appendChild(S({boardSize:j.boardSize})),Object.values(j.players).forEach((N)=>{if(N.state!=="playing"){if(N.uuid===j.uuid)document.querySelector("#gameOver").textContent=N.state;return}const{pos:F,color:H}=N;F.forEach((B)=>{document.querySelector(`#cell-${B.row}-${B.col}`).style.backgroundColor=`#${H}`})}),j.foodLocations.forEach((N)=>{document.querySelector(`#cell-${N.row}-${N.col}`)?.append(f("div",{className:"h-1/2 w-1/2 bg-black rotate-45"}))})}}}),f("label",{className:"flex items-center gap-4",textContent:"Pick you color:",htmlFor:"colorPicker"},[f("input",{id:"colorPicker",type:"color",value:"#"+[...Array(6).keys()].map(()=>Math.floor(Math.random()*16).toString(16)).join("")})]),f("span",{id:"gameOver"})]),f("div",{id:"board",className:"aspect-square flex justify-center items-center"}),f("div",{className:"grid grid-cols-3 mx-auto"},[f("div"),f("div",{className:"aspect-square text-8xl",textContent:"\u2B06",onclick:()=>m("ArrowUp")}),f("div"),f("div",{className:"aspect-square text-8xl",textContent:"\u2B05",onclick:()=>m("ArrowLeft")}),f("div"),f("div",{className:"aspect-square text-8xl",textContent:"\u27A1",onclick:()=>m("ArrowRight")}),f("div"),f("div",{className:"aspect-square text-8xl",textContent:"\u2B07",onclick:()=>m("ArrowDown")}),f("div")]));
